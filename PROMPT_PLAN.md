# VELOCITY AGENTIC PROTOCOL - PROMPT_PLAN.md
>
> **SOURCE OF TRUTH**: This document supersedes all chat history. Refer to this before making architectural changes.

## 1. MISSION

To build a scalable "Industrial AI" web development factory that standardizes the creation, deployment, and management of web properties ("Nodes") using a 3-tier architecture. Branding is strictly **VELOCITY**.

## 2. ARCHITECTURE & TECH STACK

### Tier 1: The Control Plane (Dashboard)

- **Path**: `/avon-dashboard`
- **Tech**: Next.js 15+ (App Router), React 19, Tailwind CSS v4.
- **Port**: `3000`
- **Role**: User Interface for managing nodes. MUST NOT contain business logic for builds.
- **State**: Uses Supabase (auth/db) and local API calls.

### Tier 2: The Factory Core (Backend)

- **Path**: `/avon-backend`
- **Tech**: Node.js, Express 4.x.
- **Port**: `4000`
- **Role**: Allocates resources, orchestrates Ollama, manages state (`registry.json` mock DB).
- **Security**: strict CORS (`localhost:3000`, `localhost:3001`), Environment Variables (`.env`).
- **AI Integration**: Direct Ollama Interface (Model: `Avon:latest` or `codegemma`).
- **Output Standard**: JSON containing `build_artifact` (Pure HTML/CSS/JS).

### Tier 3: The Edge Renderer (Preview Nodes)

- **Path**: `/avon-dev-node`
- **Tech**: Vite, React 19, Tailwind CSS.
- **Port**: `3001` (Strict).
- **Role**: visualizes the code generated by Tier 2.
- **Mode A (Live)**: Renders `node.build_artifact` (HTML) in a sandboxed `<iframe>`.
- **Mode B (Terminal)**: Renders `node.ai_plan` as a streaming terminal log (fallback).

## 3. NAMING CONVENTIONS

- **Nodes**: `node_<timestamp>` (e.g., `node_1771554297574`)
- **Domains**: `node-*.velocity.dev`
- **Roles**: `velocity_admin`, `industrial`
- **System Name**: "Velocity Industrial Backend"

## 4. EXECUTION RULES (The Guardian Layer)

1. **No "Vibe Coding"**: Do not guess schema. Read `supabase_schema.sql` or `registry.json`.
2. **Artifact Integrity**: Generated code MUST be self-contained (Single HTML file preferred for v1).
3. **Port Discipline**:
    - Dashboard: 3000
    - Preview: 3001
    - Backend: 4000
4. **Error Handling**: If a build fails, report "Sync Failure" visually, do not crash the server.

## 5. ASSET STRATEGY

- **Images**: MUST use `https://image.pollinations.ai/prompt/{description}` for dynamic, copyright-free, relevant visuals.
- **Copy**: MUST be AI-generated marketing text specific to the niche. NO "Lorem Ipsum".

## 6. NEXT STEPS (Roadmap)

- [x] **Asset Rules**: Implemented via System Prompt.
- [x] **Guardian Layer**: HTML/XSS Validation active.
- [x] **Infrastructure Abstraction**: Move `registry.json` Logic to a generic `StorageInterface` class.

## 7. METHODOLOGY (VIBE ARCHITECT)

- **Protocol**: Strictly follow `.agent/workflows/vibe_architect.md`.
- **Phase 1**: Requirement Parsing & Goal Definition.
- **Phase 2**: Backend-First Implementation (Schema -> API -> UI).
- **Phase 3**: Iterative Hardening (Security, Performance).
- **Constraint**: NEVER build UI before Data Model is clear.
